{% extends "base.html" %}
{% block title %}Facility Detail{% endblock %}
{% block content %}

<main class="container">
  <h1>Facility</h1>

  <section class="card">
    <h2 id="fac-name">Facility: …</h2>
    <p id="fac-loc">Location: …</p>
    <p id="fac-id">ID: …</p>
    <p id="fac-grid">Grid Region: …</p>
  </section>

  <section class="card">
    <h2>Quick Metrics (manual entry)</h2>
    <p>Enter activity values with units so they can be logged as Scope 1/2 activities later.</p>

    <form id="quick-metrics-form" class="grid-2">
      <label>
        Monthly Electricity (kWh)
        <input type="number" step="0.01" name="kwh" placeholder="kWh" />
      </label>
      <label>
        Natural Gas (therms)
        <input type="number" step="0.01" name="therms" placeholder="therms" />
      </label>
      <label>
        Diesel (gallons)
        <input type="number" step="0.01" name="diesel_gal" placeholder="gal" />
      </label>
      <label>
        Water (m³)
        <input type="number" step="0.01" name="water_m3" placeholder="m³" />
      </label>
      <div>
        <button type="submit">Save Metrics</button>
      </div>
    </form>

    <small>Units: electricity=kWh, gas=therms, diesel=gallons, water=cubic meters.</small>
  </section>

  <section class="card">
    <h2>Recent Activity (placeholder)</h2>
    <div id="recent-activity">No entries yet.</div>
  </section>
</main>

<script>
(function () {
  const FACILITY_ID =
      (typeof window.FACILITY_ID !== "undefined" && window.FACILITY_ID) ||
      window.location.pathname.split("/").pop();

  // Correct DOM references
  const nameEl = document.getElementById("fac-name");
  const locEl  = document.getElementById("fac-loc");
  const idEl   = document.getElementById("fac-id");
  const gridEl = document.getElementById("fac-grid");

  async function loadFacility() {
    try {
      const resp = await fetch(`/api/facilities/${FACILITY_ID}`, {
        credentials: "same-origin",
      });
      if (!resp.ok) {
        console.error("Failed to load facility");
        return;
      }
      const data = await resp.json();

      // Display in TEXT, not .value
      nameEl.textContent = `Facility: ${data.name}`;
      locEl.textContent  = `Location: ${data.location ?? ""}`;
      idEl.textContent   = `ID: ${data.facility_id}`;
      gridEl.textContent = `Grid Region: ${data.grid_region_code ?? ""}`;

    } catch (err) {
      console.error(err);
    }
  }

  // Prevent page reload from metrics form
  document.getElementById("quick-metrics-form").addEventListener("submit", (e) => {
    e.preventDefault();
    alert("Metrics saved (placeholder, no backend yet)");
  });

  loadFacility();
})();
</script>

{% endblock %}
