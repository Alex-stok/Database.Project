{% extends "base.html" %}
{% block title %}Facility Detail{% endblock %}
{% block content %}
<main class="container">
  <h1>Facility</h1>

  <!-- Facility Info -->
  <section class="card">
    <h2 id="fac-name">Facility: …</h2>
    <p id="fac-loc">Location: …</p>
    <p id="fac-id">ID: …</p>
    <p id="fac-grid">Grid Region: …</p>
  </section>

  <!-- Add Activity Button -->
  <section class="card">
    <a class="btn" href="/activities/new?facility_id={{ facility_id }}">
      Add Activity
    </a>
  </section>

  <!-- Recent Activity Placeholder -->
  <section class="card">
    <h2>Recent Activity</h2>
    <div id="recent">No entries yet.</div>
  </section>
</main>

<script>
(function () {
    const facilityId = "{{ facility_id }}";
    const token = localStorage.getItem("token");

    // Correct element references
    const facName = document.getElementById("fac-name");
    const facLoc = document.getElementById("fac-loc");
    const facId = document.getElementById("fac-id");
    const facGrid = document.getElementById("fac-grid");

    // -----------------------------
    // Load facility details
    // -----------------------------
    async function loadFacility() {
        const resp = await fetch(`/api/facilities/${facilityId}`, {
            headers: { "Authorization": `Bearer ${token}` }
        });

        if (!resp.ok) {
            facName.textContent = "Facility: (Error loading)";
            return;
        }

        const data = await resp.json();

        facName.textContent = "Facility: " + (data.name || "");
        facLoc.textContent = "Location: " + (data.location || "");
        facId.textContent = "ID: " + (data.facility_id || "");
        facGrid.textContent = "Grid Region: " + (data.grid_region_code || "");
    }

    loadFacility();
})();
</script>
{% endblock %}
