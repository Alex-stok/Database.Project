{% extends "base.html" %}
{% block title %}New Activity{% endblock %}
{% block content %}
<main class="container">
    <h1>New Activity</h1>

    <form id="activity-form">
        <label>Activity type
            <select id="activity_type_id">
                <option value="">Select type</option>
                {% for t in types %}
                    <option value="{{t.activity_type_id}}">{{t.label}}</option>
                {% endfor %}
            </select>
        </label>

        <label>Quantity
            <input type="number" id="quantity" step="0.001">
        </label>

        <label>Unit
            <select id="unit_id">
                <option value="">Select unit</option>
                {% for u in units %}
                    <option value="{{u.unit_id}}">{{u.code}}</option>
                {% endfor %}
            </select>
        </label>

        <label>Date
            <input type="date" id="activity_date">
        </label>

        <label>Facility
            <select id="facility_id">
                {% for f in facilities %}
                    <option value="{{f.facility_id}}">{{f.name}}</option>
                {% endfor %}
            </select>
        </label>

        <button type="submit">Save</button>
    </form>
</main>

<script>
document.getElementById("activity-form").addEventListener("submit", async (e) => {
    e.preventDefault();

    const payload = {
        activity_type_id: document.getElementById("activity_type_id").value,
        unit_id: document.getElementById("unit_id").value,
        facility_id: document.getElementById("facility_id").value,
        quantity: document.getElementById("quantity").value,
        activity_date: document.getElementById("activity_date").value
    };

    const resp = await fetch("/api/activities", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify(payload),
    });

    const data = await resp.json();
    alert(JSON.stringify(data));
});
</script>
{% endblock %}
