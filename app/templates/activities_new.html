
{% extends "base.html" %}
{% block title %}Page Title Here{% endblock %}
{% block content %}
<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Log Activity</title>
  <link rel="stylesheet" href="/static/css/main.css">
</head>

<body>
  <h2>New Activity</h2>
  <form id="activityForm">
    <label>Activity type
      <select name="activity_type">
        <option value="electricity">Electricity</option>
        <option value="natural_gas">Natural Gas</option>
        <option value="diesel">Diesel Fuel</option>
        <option value="gasoline">Gasoline Fuel</option>
        <option value="shipping">Freight/Shipping</option>
        <option value="process">Process Emissions</option>
      </select>
    </label>

    <label>Quantity
      <input type="number" step="0.0001" name="quantity" required>
    </label>

    <label>Unit (required for accuracy)
      <select name="unit" required>
        <option value="kWh">kWh (electricity)</option>
        <option value="therm">therm (natural gas)</option>
        <option value="m3">mÂ³ (natural gas or water)</option>
        <option value="gal">gallons (fuels)</option>
        <option value="L">liters (fuels)</option>
        <option value="ton_mile">ton-mile (freight)</option>
        <option value="kg">kg (process/material)</option>
      </select>
    </label>

    <label>Activity date <input type="date" name="activity_date" required></label>
    <label>Facility ID <input type="number" name="facility_id" placeholder="e.g., 1"></label>
    <button type="submit">Submit</button>

    <script>
(function () {
  const token = localStorage.getItem('token') || '';
  const form = document.getElementById('activityForm');

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    const fd = new FormData(form);
    const payload = Object.fromEntries(fd.entries());

    // convert numeric fields
    if (payload.quantity) payload.quantity = Number(payload.quantity);
    if (payload.facility_id) payload.facility_id = Number(payload.facility_id);

    const resp = await fetch('/api/activities', {
      method: 'POST',
      headers: {
        'Authorization': 'Bearer ' + token,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(payload)
    });

    if (!resp.ok) {
      const txt = await resp.text();
      alert('Failed to save activity: ' + txt);
      return;
    }
    alert('Activity logged.');
    form.reset();
  });
})();
</script>

  </form>
</body>
</html>

{% endblock %}